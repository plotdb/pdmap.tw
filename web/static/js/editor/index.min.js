!function(){var e,t,n,r;e=pdmaptw.create({root:"#map",type:"town"}),t=[["縣市","鄉鎮","數值"]],n={hover:{},scale:d3.interpolateSpectral},r={},e.init().then(function(){var o,a,i,l,d,u,c,s,f,p,m,h,v,g,w;return e.fit(),o=e.lc.meta.name,e.lc.features.map(function(e){var n,a,i;return n=[o[e.properties.c],o[e.properties.t]],a=n[0],i=n[1],t.push([a,i]),(r[a]||(r[a]={}))[i]=e}),a=debounce(350,function(){if(void 0!==h&&null!==h)return h.render("download")}),(i=function(){return d3.select(e.root).selectAll("path").transition().duration(350).attr("fill",function(e){var t;return t=(e.properties.value-n.min)/(n.max-n.min||1),n.scale(t)}),a()})(),Handsontable.renderers.registerRenderer("myrenderer",function(e,t,n,r,o,a,i){Handsontable.renderers.TextRenderer.apply(this,arguments),0===n&&t.classList.add("head"),isNaN(a)}),l={},d=function(e,n){var r;return n=n?1:-1,r=t.splice(0,1)[0],t.sort(function(t,r){return n*(t[e]>r[e]?1:t[e]<r[e]?-1:0)}),t.splice(0,0,r),u.render()},u=new Handsontable(sheet,{afterChange:function(){var e;return t.map(function(e){if(r[e[0]])return r[e[0]][e[1]].properties.value=e[2]}),e=t.map(function(e){return e[2]||0}).splice(1),n.max=Math.max.apply(null,e),n.min=Math.min.apply(null,e),i()},afterSelection:function(e,t,n,r){if(e===n&&0===n&&t===r&&r<3)return d(r,l[r]=!l[r])},data:t,fixedRowsTop:1,rowHeaders:!0,colHeaders:!0,filters:!0,dropdownMenu:!0,stretchH:"all",rowHeights:25,minRows:50,minCols:15,cells:function(e,t){var n;return n={},n.renderer="myrenderer",0===e&&(n.readOnly=!0),n},customBorders:[{range:{from:{row:0,col:0},to:{row:0,col:99}},bottom:{width:2,color:"#000"}}]}),(c=function(){return t.map(function(e,t){if(t>0)return e[2]=Math.round(100*Math.random())}),u.loadData(t),u.render()})(),s=ldPalettePicker.init({ldcv:{},pals:ldPalettePicker.get("loadingio")}),f=function(e){var t,r;if(e)return t=e.colors.map(function(e){return ldColor.hex(e)}),r=t.map(function(e,n){return n/(t.length-1)}),n.scale=d3.scaleLinear().domain(r).range(t).interpolate(d3.interpolateHcl),i()},p=ldPalettePicker.get("loadingio").filter(function(e){return e.colos.length>3}),f(p[Math.floor(p.length*Math.random())]),m=ld$.find(document.body,"svg",0),h=new ldView({root:document.body,handler:{download:function(e){var t,n;return t=e.node,m.setAttribute("xmlns","http://www.w3.org/2000/svg"),n=URL.createObjectURL(new Blob([m.outerHTML],{type:"text/svg+xml"})),t.setAttribute("href",n),t.setAttribute("download","map.svg"),t.classList.remove("disabled")}},action:{click:{palette:function(e){return e.node,s[0].get().then(function(e){return f(e)})},random:function(e){return e.node,c()}}}}),v=ld$.find(document.body,"#popup",0),g=new ldView({root:v,handler:{name:function(e){var t;return t=e.node,t.innerText=n.hover.name||""},value:function(e){var t;return t=e.node,t.innerText=n.hover.value}}}),w=debounce(2e3,function(){return v.classList.add("ld","ld-fade-out")}),m.addEventListener("mouseover",function(r){var o,a,i,l,d,u,c,s,f,p,m,h,b,x;if((o=d3.select(r.target).datum())&&(a=e.lc.meta.name[o.properties.c],i=e.lc.meta.name[o.properties.t],l=t.filter(function(e){return e[0]===a&&e[1]===i})[0]))return d=l[2],n.hover={name:a+""+i,value:d},g.render(),u=v.parentNode.getBoundingClientRect(),c=v.getBoundingClientRect(),s=[r.clientX-u.x,r.clientY-u.y],f=s[0],p=s[1],m=(f<u.width/2?1:-1)*((s=.05*u.width)>20?s:20),h=(p<u.height/2?1:-1)*((s=.05*u.height)>20?s:20),f>u.width/2&&(m-=c.width),p>u.height/2&&(h-=c.height),s=[f+m,p+h],b=s[0],x=s[1],v.style.transform="translate("+b+"px, "+x+"px)",v.classList.remove("ld","ld-fade-out","d-none"),w()})})}();